# Lua 

[www.lua.org](https://www.lua.org/docs.html)

Язык Lua — это легковесный, интерпретируемый, высокоуровневый язык программирования. Сам интерпретатор Lua реализован на чистом ANSI C.

Он был создан с акцентом на простоту, гибкость, переносимость и лёгкую интеграцию с другими языками, особенно с C.

> В игре Roblox основным языком для написания скриптов является Lua, а точнее его диалект Luau (совместим с Lua 5.1).
> 
> [Roblox API](https://developer.roblox.com/)

**Встраиваемость** (Embeddability) 
   Lua спроектирован как встраиваемый скриптовый язык. Это означает, что его часто используют не как самостоятельный язык для написания полноценных приложений, а как расширение или скриптовый движок внутри других программ, написанных, например, на C, C++ или другом языке.

**Через C API можно**:
   - вызывать Lua-скрипты из C-кода,
   - передавать данные из C в Lua и обратно,
   - регистрировать C-функции, которые могут вызываться из Lua.

**Конфигурация и скриптование** 
   Lua часто применяется для:
   - описания логики поведения в играх (например, поведение NPC, квесты, события),
   - настройки сложных приложений,
   - автоматизации задач в программах.

**Применяется для гибкости**:
- Программа на C/C++ вызывает Lua-скрипты для настройки поведения, без перекомпиляции.
- C — компилируемый, изменение логики требует перекомпиляции.
- Lua — интерпретируемый, его можно изменять "на лету", что идеально для:
  - быстрой итерации в разработке,
  - пользовательских модификаций (модов, аддонов),
- Например, если вы делаете IoT-устройство, и хотите, чтобы пользователи могли менять логику без перепрошивки.
- Или если вы разрабатываете промышленный контроллер с возможностью кастомизации через скрипты.

**Производительность**:
   - Без JIT (а **LuaJIT не работает на ARM Cortex-M без MMU и ОС**) Lua значительно медленнее C.
   - Для вычислительно тяжёлых задач лучше использовать C и вызывать его из Lua.

**Отсутствие типобезопасности и защиты от ошибок**:
   - В критических системах (медицинские устройства, автопилоты) Lua редко используют

**Lua особенно хорош в embedded-средах, если**:
 - Интерпретатор Lua (без JIT) может занимать от 200 КБ до 1 МБ в зависимости от конфигурации. Lua использует динамическое выделение памяти и сборку мусора (GC) 
- Минимальная версия (например, Lua 5.4, собранная с отключёнными библиотеками) может работать даже при 64–256 КБ ОЗУ (хотя это уже предел).
- Lua работает на 32-битных (и даже некоторых 16-битных) микроконтроллерах, но комфортнее всего — на ARM Cortex-M3/M4/M7 и выше.
- Примеры платформ: ESP32, STM32, Raspberry Pi Pico (с достаточной RAM), Linux-based embedded (например, на OpenWrt).



## Install

```
sudo apt update
sudo apt install lua5.4 liblua5.4-dev
lua -v
    Lua 5.4.6  Copyright (C) 1994-2023 Lua.org, PUC-Rio

# Path lua libray
dpkg -L liblua5.4-dev | grep lua.h
    /usr/include/lua5.4/lua.h
    /usr/include/lua5.4/lua.hpp

```

Команда GCC должна указывать путь к заголовкам через -I, иначе компилятор ищет их только в стандартных /usr/include


```
-I/usr/include/lua5.4

```

Настройка проекта .vscode/c_cpp_properties.json

```json
{
    "configurations": [
        {
            "name": "Linux",
            "includePath": [
                "${workspaceFolder}/**",
                "/usr/include/lua5.4"
            ],
            "defines": [],
            "compilerPath": "/usr/bin/gcc",
            "cStandard": "c99",
            "cppStandard": "c++17",
            "intelliSenseMode": "linux-gcc-x64",
            "browse": {
                "path": [
                    "/usr/include/lua5.4"
                ],
                "limitSymbolsToIncludedHeaders": true
            }
        }
    ],
    "version": 4
}
```

**Compiling:**

```
gcc -std=c99 -Wall -Wextra -Wformat -Werror -Wconversion -Wformat=2 -Wformat-security -fdiagnostics-color=always -fmessage-length=0 -Wformat-diag \
-I/usr/include/lua5.4 -O0 main.c -o my_program.out -llua5.4 -lm -ldl
```

Где:
* -I — для компилятора, путь к заголовочным файлам при include
   * -I/usr/include/lua5.4 → путь к Lua заголовкам (lua.h, lauxlib.h, lualib.h)
* -L — для линкера, бинарные библиотеки, путь к библиотекам (liblua.so, liblua.a). Нужно линкеру, чтобы он мог найти реализацию функций при сборке если они в нестандартном месте, например /usr/local/lib или /home/user/mylibs.
   * -L/usr/local/lib
* -llua — линковка с Lua
   * -llua5.4 → линковка с библиотекой Lua
* -lm -ldl → дополнительные зависимости Lua на Linux
